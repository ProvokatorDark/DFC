# Dangerous Functions Checker


# Алгоритм поиска вирусов

*  Выкачать сайт локально

	`./0_lftp.sh`

* Проверить сайт этим скриптом. Результаты проверки будут в каталоге detected. Эти файлы проверяем вручную, названия подозрительных вручную заносим в файл suspected.txt (один файл на строку)

	`./1_scan.sh www`

* Поиск PHP-файлов с длинными строками, вывод начала и конца каждого найденного файла в файл longlines.txt, подозрительные также добавляем в suspected.txt

	`find www/ -name "*.php" -exec ./2_longlines.sh {} \; > longlines.txt`

* Поиск php-кода в файлов с расширениями не .php:

	`./3_php_in_nophp.sh www > php_in_nophp.txt`

* Также есть скрипт для вытаскивания из отчёта айболита  (https://revisium.com/ai/) файлов, которые он в чём-то заподозрил. Лучше визуально проверить, все ли файлы он нашёл и не нашёл ли лишнего (скрипт пока не идеален). Найденные файлы добавляем в suspected.txt.

	`php -f parse_aibolit_report.php aibolit_report.html`

* Делаем резервную копию файлов, отмеченных как подозрительные, в каталог virii

	`php -f 4_backup_virii.php suspected.txt`

* Вручную просматриваем каждый файл из подозрительных, вирусы удаляем, файлы сохраняем

	`./5_view.sh suspected.txt`

* Проводим анализ сделанных нами изменений по сравнению с каталогом virii. Если файл изменён, оставляем его копию в каталоге virii и записываем его название в файл files_repl.txt. Если размер файла - 0 или 1 (т. е. его содержимое удалено), то удаляем этот файл, его копию оставляем в каталоге virii и записываем его название в файл files_del.txt. Если файл идентичен своей копии, лежащей в virii, т. е. файл не изменился, значит, файл не заражён, удаляем его копию из каталога virii.

	`php -f 6_diff_virii.php suspected.txt`

